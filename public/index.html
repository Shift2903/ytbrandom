<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bouton VidÃ©o AlÃ©atoire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .btn-3d { transition: all 0.15s ease-out; box-shadow: 0 5px 0 0 #c72b2b; }
        .btn-3d:hover:not(:disabled) { transform: translateY(2px); box-shadow: 0 3px 0 0 #c72b2b; }
        .btn-3d:active:not(:disabled) { transform: translateY(5px); box-shadow: 0 0px 0 0 #c72b2b; }
        .btn-3d:disabled { background-color: #ef4444; opacity: 0.7; cursor: not-allowed; }
        #videoContainer { position: relative; width: 100%; padding-top: 56.25%; background: #000; }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .category-link.active { background-color: #ef4444; color: white; }
        .lang-flag { cursor: pointer; transition: transform 0.2s; filter: grayscale(80%); opacity: 0.7; }
        .lang-flag:hover, .lang-flag.active { transform: scale(1.2); filter: grayscale(0%); opacity: 1; }
        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.75rem; /* 12px */
            width: 1.25rem; /* 20px */
            height: 1.25rem; /* 20px */
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <nav class="w-full bg-gray-800 p-3 shadow-lg border-b border-gray-700 flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <span class="lang-flag" data-lang="fr" title="FranÃ§ais">ðŸ‡«ðŸ‡·</span>
            <span class="lang-flag" data-lang="en" title="English">ðŸ‡¬ðŸ‡§</span>
            <span class="lang-flag" data-lang="es" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸</span>
            <span class="lang-flag" data-lang="de" title="Deutsch">ðŸ‡©ðŸ‡ª</span>
        </div>
        <div class="flex items-center space-x-2">
            <a href="#" class="category-link px-4 py-2 rounded-md text-sm font-bold" data-category="all">ALL</a>
            <a href="#" class="category-link px-4 py-2 rounded-md text-sm font-bold" data-category="music">MUSIQUE</a>
        </div>
    </nav>

    <div class="flex flex-col lg:flex-row flex-grow" style="min-height: calc(100vh - 60px);">
        <aside class="w-full lg:w-64 bg-gray-800 p-4 border-r border-gray-700 hidden lg:flex lg:flex-col">
            <h2 class="text-lg font-bold mb-4" data-key="adTitle">PublicitÃ©</h2>
            <div class="flex-grow bg-gray-700 rounded-lg flex items-center justify-center">
                <span class="text-gray-500">Espace Pub 1</span>
            </div>
        </aside>

        <main class="flex-grow p-4 lg:p-8">
            <header class="mb-8">
                 <h1 data-key="title" class="text-4xl font-black text-white">DÃ©couvrez une VidÃ©o.</h1>
                 <p data-key="description" class="text-lg text-gray-400">Cliquez pour lancer une vidÃ©o YouTube au hasard.</p>
            </header>
            
            <div id="videoContainer" class="rounded-xl overflow-hidden shadow-2xl">
                <div id="player"></div>
                <div id="welcomeMessage" class="h-full flex flex-col items-center justify-center text-center p-8 absolute inset-0 text-white bg-black bg-opacity-50">
                    <svg class="w-24 h-24 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h2 data-key="welcome" class="text-3xl font-semibold mt-4">Bienvenue !</h2>
                    <p data-key="welcomeSub" class="mt-2 text-lg text-gray-400">Cliquez sur le bouton Ã  droite pour commencer.</p>
                </div>
            </div>
            
            <div id="videoInfo" class="mt-4 p-4 bg-gray-800 rounded-lg hidden">
                <h3 id="videoTitle" class="text-xl font-bold">Titre de la vidÃ©o</h3>
            </div>
        </main>

        <aside class="w-full lg:w-80 bg-gray-800 p-6 border-l border-gray-700 flex flex-col space-y-8">
            <button id="randomVideoBtn" class="w-full bg-red-600 text-white font-bold text-xl px-6 py-4 rounded-xl shadow-lg btn-3d flex items-center justify-center">
                <span data-key="button">NOUVELLE VIDÃ‰O</span>
            </button>
            <div class="flex-grow flex flex-col min-h-0">
                <h2 class="text-lg font-bold mb-4" data-key="historyTitle">ActivitÃ© de la session</h2>
                <div id="historyContainer" class="bg-gray-900 rounded-lg p-3 space-y-2 flex-grow overflow-y-auto">
                    <p id="historyPlaceholder" class="text-sm text-gray-400" data-key="historyPlaceholder">Votre historique apparaÃ®tra ici...</p>
                </div>
            </div>
        </aside>
    </div>

    <script>
        const SERVER_URL = 'http://localhost:3000'; // Mettez votre URL ngrok ici si vous hÃ©bergez le client
        
        let currentCategory = 'all';
        let lastTriedVideo = null;
        let player;
        
        const welcomeMessage = document.getElementById('welcomeMessage');
        const videoInfoBox = document.getElementById('videoInfo');
        const videoTitleElem = document.getElementById('videoTitle');
        const historyContainer = document.getElementById('historyContainer');
        const historyPlaceholder = document.getElementById('historyPlaceholder');
        const randomVideoBtn = document.getElementById('randomVideoBtn');
        const btnTextSpan = randomVideoBtn.querySelector('span');

        const translations = {
            'fr': { title: 'DÃ©couvrez une VidÃ©o.', description: 'Cliquez pour lancer une vidÃ©o YouTube au hasard.', button: 'NOUVELLE VIDÃ‰O', loadingButton: 'RECHERCHE...', historyTitle: 'ActivitÃ© de la session', historyPlaceholder: 'Votre historique apparaÃ®tra ici...', adTitle: 'PublicitÃ©', welcome: 'Bienvenue !', welcomeSub: 'Cliquez sur le bouton Ã  droite pour commencer.'},
            'en': { title: 'Discover a Video.', description: 'Click to launch a random YouTube video.', button: 'NEW VIDEO', loadingButton: 'SEARCHING...', historyTitle: 'Session Activity', historyPlaceholder: 'Your history will appear here...', adTitle: 'Advertisement', welcome: 'Welcome!', welcomeSub: 'Click the button on the right to start.'},
            'es': { title: 'Descubre un Video.', description: 'Haz clic para iniciar un video de YouTube al azar.', button: 'NUEVO VIDEO', loadingButton: 'BUSCANDO...', historyTitle: 'Actividad de la sesiÃ³n', historyPlaceholder: 'Tu historial aparecerÃ¡ aquÃ­...', adTitle: 'Publicidad', welcome: 'Â¡Bienvenido!', welcomeSub: 'Haz clic en el botÃ³n de la derecha para empezar.'},
            'de': { title: 'Entdecke ein Video.', description: 'Klicke, um ein zufÃ¤lliges YouTube-Video zu starten.', button: 'NEUES VIDEO', loadingButton: 'SUCHEN...', historyTitle: 'SitzungsaktivitÃ¤t', historyPlaceholder: 'Dein Verlauf wird hier angezeigt...', adTitle: 'Werbung', welcome: 'Willkommen!', welcomeSub: 'Klicke auf die SchaltflÃ¤che rechts, um zu starten.'}
        };

        function setLanguage(lang) {
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.dataset.key;
                if(translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            document.querySelectorAll('.lang-flag').forEach(flag => flag.classList.toggle('active', flag.dataset.lang === lang));
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const userLang = navigator.language.split('-')[0];
            setLanguage(translations[userLang] ? userLang : 'fr');
            document.querySelectorAll('.lang-flag').forEach(flag => flag.addEventListener('click', (e) => setLanguage(e.target.dataset.lang)));
            document.querySelectorAll('.category-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentCategory = e.target.dataset.category;
                    document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });
            document.querySelector('.category-link[data-category="all"]').classList.add('active');
        });

        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function updateVideoInfo(videoData) {
            videoTitleElem.textContent = videoData.title;
            videoInfoBox.classList.remove('hidden');

            if (historyPlaceholder) historyPlaceholder.style.display = 'none';
            const historyItem = document.createElement('div');
            historyItem.className = 'flex items-center space-x-3 bg-gray-800 p-2 rounded';
            historyItem.innerHTML = `<img src="${videoData.thumbnail}" class="w-16 h-12 object-cover rounded" alt="Miniature"><p class="text-sm flex-1">${videoData.title}</p>`;
            historyContainer.prepend(historyItem);
        }

        async function loadRandomVideo() {
            if (welcomeMessage) welcomeMessage.style.display = 'none';
            
            randomVideoBtn.disabled = true;
            const currentLang = document.querySelector('.lang-flag.active')?.dataset.lang || 'fr';
            btnTextSpan.innerHTML = `<div class="spinner"></div> ${translations[currentLang].loadingButton}`;

            try {
                const response = await fetch(`${SERVER_URL}/api/random-video?category=${currentCategory}`);
                if (!response.ok) throw new Error(`Erreur serveur: ${response.statusText}`);
                const data = await response.json();
                lastTriedVideo = { id: data.videoId, category: currentCategory, title: data.title, thumbnail: data.thumbnail };
                player.loadVideoById(lastTriedVideo.id);
                updateVideoInfo(lastTriedVideo);
            } catch (error) {
                console.error("Erreur de communication avec le serveur:", error);
                welcomeMessage.innerHTML = `<h2 class="text-2xl font-semibold text-red-500">Erreur Serveur</h2><p class="mt-2">Impossible de contacter le serveur.</p>`;
                welcomeMessage.style.display = 'flex';
            } finally {
                randomVideoBtn.disabled = false;
                btnTextSpan.innerHTML = translations[currentLang].button;
            }
        }
        
        async function reportBadVideo(video) {
            if (!video) return;
            console.warn(`Signalement de la vidÃ©o dÃ©fectueuse ${video.id} au serveur...`);
            await fetch(`${SERVER_URL}/api/report-bad-video`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ videoId: video.id, category: video.category }),
            }).catch(error => console.error("Erreur lors du signalement:", error));
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%',
                playerVars: { 'autoplay': 1, 'controls': 1, 'modestbranding': 1 },
                events: { 'onReady': onPlayerReady, 'onError': onPlayerError }
            });
        }

        function onPlayerReady(event) {
            randomVideoBtn.addEventListener('click', loadRandomVideo);
        }

        async function onPlayerError(event) {
            await reportBadVideo(lastTriedVideo);
            loadRandomVideo();
        }
    </script>
</body>
</html>
